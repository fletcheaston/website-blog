import{j as e,U as r,I as t,L as n}from"./main-CV-jdQ_C.js";import{T as o}from"./code-block-BIvcJb77.js";import{B as i}from"./layout-BHv86BKp.js";import{H as l,a as s}from"./header-BtPm5KK-.js";import"./button-DiQvsG2T.js";const u=function(){return e.jsxs(e.Fragment,{children:[e.jsx(i,{to:r.fullPath}),e.jsx(l,{hash:"react",children:"Next.js / React / TypeScript"}),e.jsx("p",{children:e.jsx("a",{href:"https://www.npmjs.com/package/z3-solver",target:"_blank",children:"View the npm package here."})}),e.jsxs("p",{children:[e.jsx("code",{children:"z3-solver"})," works with JavaScript apps through bindings to WebAssembly."]}),e.jsx("p",{children:"Some important notes from the npm package:"}),e.jsxs("div",{className:"mt-4 rounded border-l-4 border-l-emerald-700 pl-2",children:[e.jsxs("p",{children:["The package requires threads, which means you'll need to be running in an environment which supports ",e.jsx("code",{children:"SharedArrayBuffer"})," ... you'll need to serve your page with"," ",e.jsx("a",{href:"https://web.dev/coop-coep/",target:"_blank",children:"special headers"}),"."]}),e.jsxs("p",{children:["When building for the web, you should include that file [",e.jsx("code",{children:"z3-built.js"}),"] as its own script on the page."]})]}),e.jsxs("p",{className:"mt-4",children:["With those notes in mind, let's get started integrating ",e.jsx("code",{children:"z3-solver"})," into your Next.js app!"]}),e.jsx(s,{hash:"next-js-install-package",children:"1) Install the package"}),e.jsxs("p",{children:["From your terminal, run ",e.jsx("code",{children:"npm install z3-solver"}),"."]}),e.jsx(s,{hash:"next-js-copy-files",children:"2) Copy Build Files"}),e.jsxs("p",{children:["Once installed, you'll need to copy some pre-built files that ",e.jsx("code",{children:"z3-solver"})," ","provides into your application. If you're running ",e.jsx("code",{children:"z3-solver"})," in a Node.js environment, i.e. using Server Actions in Next.js, you can skip this step. If you're using ",e.jsx("code",{children:"z3-solver"})," client-side, i.e. in the browser, this is required."]}),e.jsx("p",{children:"Files:"}),e.jsxs("ul",{children:[e.jsx("li",{children:e.jsx("code",{children:"node_modules/z3-solver/build/z3-built.js"})}),e.jsx("li",{children:e.jsx("code",{children:"node_modules/z3-solver/build/z3-built.wasm"})}),e.jsx("li",{children:e.jsx("code",{children:"node_modules/z3-solver/build/z3-built.worker.js"})})]}),e.jsxs("p",{children:["You'll copy these files into your ",e.jsx("code",{children:"public"})," directory in your Next.js app."]}),e.jsx(s,{hash:"next-js-import-script",children:"3) Import the Script"}),e.jsxs("p",{children:["Add a"," ",e.jsxs("code",{children:["<","script",">"]})," ","component to the page/component that requires the ",e.jsx("code",{children:"z3-solver"})," package. You have two options here:"]}),e.jsxs("h4",{children:["Option 1: Add a"," ",e.jsxs("a",{href:"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script",target:"_blank",children:[e.jsxs("code",{children:["<","script",">"]})," ","component"]})," ","that loads the public file synchronously."]}),e.jsx(o,{content:'<script src="/z3-built.js" />'}),e.jsx("p",{children:"This will defer loading of your page/component until the script has been downloaded. This may hurt the first-time-to-load performance of your page, but is the easiest way to guarentee that the scripts have been loaded."}),e.jsxs("p",{children:["Be warned, Next.js will throw a ",e.jsx("code",{children:"@next/next/no-sync-scripts"})," error when you try to build the app. You can disable this error, or you can try the option below."]}),e.jsxs("h4",{children:["Option 2: Add a"," ",e.jsxs("a",{href:"https://nextjs.org/docs/app/api-reference/components/script",target:"_blank",children:[" ",e.jsxs("code",{children:["<","Script",">"]})," ","component"]})," ","(from Next.js) that loads the public file asynchronously and updates state after loading."]}),e.jsx(o,{content:`<Script
    src="/z3-built.js"
    onLoad={() => setStatus("loaded")}
/>`}),e.jsxs("p",{children:["Your page/component will be free to load in parallel, allowing a faster initial load of your page. You can then do fine-grain state management to prevent usage of the"," ",e.jsx("code",{children:"z3-solver"})," package until the script has finished loading."]}),e.jsx(s,{hash:"next-js-add-headers",children:"4) Update Headers"}),e.jsxs("p",{children:["For ",e.jsx("code",{children:"z3-solver"}),"'s JavaScript","<","-",">","WASM bindings to work, the library requires that ",e.jsx("code",{children:"SharedArrayBuffer"})," be availble in the browser. Every major browser supports ",e.jsx("code",{children:"SharedArrayBuffer"}),", but only in a"," ",e.jsx("a",{href:"https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts",target:"_blank",children:"secure context"}),"."]}),e.jsx("p",{children:"To enable a secure context, you'll set two headers:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("code",{children:'"Cross-Origin-Opener-Policy"'})," to ",e.jsx("code",{children:'"same-origin"'})]}),e.jsxs("li",{children:[e.jsx("code",{children:'"Cross-Origin-Embedder-Policy"'})," to ",e.jsx("code",{children:'"require-corp"'})]})]}),e.jsxs("p",{children:["Add the following to your Next.js config file (",e.jsxs("code",{children:["next.config.","{","js|ts|mjs","}"]}),"):"]}),e.jsx(o,{content:`async headers() {
    return [
        {
            source: "/:path*", // Match all routes
            headers: [
                // These headers are required for z3-solver
                {
                    key: "Cross-Origin-Opener-Policy",
                    value: "same-origin",
                },
                {
                    key: "Cross-Origin-Embedder-Policy",
                    value: "require-corp",
                },
            ],
        },
    ];
},`}),e.jsxs(s,{hash:"next-js-setup-z3",children:["5) Set Up ",e.jsx("code",{className:"leading-none",children:"z3-solver"})]}),e.jsx(o,{content:`// 1) Import
import { init } from "z3-solver";

...

// 2) Initialize
// You'll need to wait for your script to be loaded first
const { Context } = await init();

// 3) Create a Context
// Types fall over beyond here
// @ts-ignore
const { Solver, Int } = new Context("main");`}),e.jsxs("p",{children:["After this, you should be set up to use ",e.jsx("code",{children:"z3-solver"}),"."]}),e.jsxs(s,{hash:"next-js-use-z3",children:["6) Use ",e.jsx("code",{className:"leading-none",children:"z3-solver"})]}),e.jsxs("p",{children:["Because the documentation is a bit lacking and the TypeScript types don't work very well, it can be a bit challenging to know how you can use ",e.jsx("code",{children:"z3-solver"})," in JavaScript."]}),e.jsxs("p",{children:["To see what methods are available for the data types (",e.jsx("code",{children:"Int"}),","," ",e.jsx("code",{children:"Real"}),", ",e.jsx("code",{children:"BitVec"}),", etc.), you can create one of those objects and ",e.jsx("code",{children:"console.log"})," it. You'll see the ",e.jsx("code",{children:"Prototype"})," methods for that object, which should give you an idea how you can use these objects."]}),e.jsx(t,{src:"/blog/software/packages/z3-solver/prototype-properties.png",alt:"The console.log output of a z3-solver Int object"}),e.jsxs("p",{className:"mt-4",children:["If you'd like to see a real example of ",e.jsx("code",{children:"z3-solver"})," being used, check out my"," ",e.jsx(n,{to:"/advent-of-code/2024/day-13",hash:"part-2-solution",children:"Advent of Code 2024 Day 13 Part 2 solution"}),"."]})]})};export{u as component};
